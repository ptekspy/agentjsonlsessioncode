import{a as x,b as v,c as a,d as P,e as _}from"./chunk-CH5BNLHD.js";var q=0;function e(s,i,r,C,g,f){i||(i={});var u,l,d=i;if("ref"in d)for(l in d={},i)l=="ref"?u=i[l]:d[l]=i[l];var m={type:s,props:d,key:r,ref:u,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--q,__i:-1,__u:0,__source:g,__self:f};if(typeof s=="function"&&(u=s.defaultProps))for(l in u)d[l]===void 0&&(d[l]=u[l]);return x.vnode&&x.vnode(m),m}var n=acquireVsCodeApi();function $(){let[s,i]=a({taskId:"default",isSessionActive:!1}),[r,C]=a(""),[g,f]=a(""),[u,l]=a("120"),[d,m]=a(""),[k,D]=a(""),[A,L]=a("20"),[S,z]=a(""),[T,E]=a(""),[R,I]=a(""),[M,F]=a(!1),[y,w]=a(""),[h,N]=a("Implement the requested change.");P(()=>{let o=c=>{let b=c.data;b?.type==="state"&&(i(b.payload),!y&&b.payload.defaultSystemPrompt&&w(b.payload.defaultSystemPrompt))};return window.addEventListener("message",o),n.postMessage({type:"ready"}),()=>window.removeEventListener("message",o)},[y]);let B=_(()=>s.isSessionActive?"Active session":"No active session",[s.isSessionActive]),p=o=>{let c=Number(u);n.postMessage({type:"runPnpmCommand",payload:{preset:o,filter:r.trim()||void 0,packages:g.trim()||void 0,timeoutMs:Number.isFinite(c)&&c>0?c*1e3:void 0}})},O=()=>{let o=T.trim(),c=Number(R);n.postMessage({type:"exportTaskJsonl",payload:{since:o.length>0?o:void 0,limit:Number.isFinite(c)&&c>0?Math.floor(c):void 0}})},U=()=>{let o=Number(A);n.postMessage({type:"searchRepo",payload:{query:d.trim()||void 0,path:k.trim()||void 0,maxResults:Number.isFinite(o)&&o>0?Math.floor(o):20}})},W=()=>{n.postMessage({type:"listDirectoryFiles",payload:{path:S.trim()||void 0}})},j=()=>{n.postMessage({type:"startSession",payload:{systemPrompt:y,userPrompt:h}})};return e("main",{style:t.container,children:[e("div",{style:t.headerRow,children:e("h2",{style:t.title,children:"Session Recorder"})}),e("details",{style:t.sectionCard,children:[e("summary",{style:t.sectionSummary,children:"Section 1: Session + Cloud"}),e("div",{style:t.section,children:[e("p",{style:t.meta,children:["Task: ",s.taskId||"default"]}),e("p",{style:t.meta,children:["Status: ",B]}),s.lastSessionSummary?e("p",{style:t.meta,children:["Last Session: ",s.lastSessionSummary.filesChanged," files,"," ",s.lastSessionSummary.commandsRecorded," commands"]}):null,s.lastSessionStatus?e("div",{style:t.qualityRow,children:[e("span",{style:t.meta,children:"Last Session Quality:"}),e("span",{style:J(s.lastSessionStatus),children:s.lastSessionStatus})]}):null,s.lastRecordPath?e("p",{style:t.path,children:["Last record: ",s.lastRecordPath]}):null,s.cloudStatus?e("span",{style:V(s.cloudStatus),children:H(s.cloudStatus)}):null,s.lastCloudCheckAt?e("span",{style:t.cloudTimestamp,children:["Last check: ",Q(s.lastCloudCheckAt)]}):null,e("button",{style:t.button,onClick:()=>n.postMessage({type:"selectTask"}),children:"Select Task"}),e("button",{style:t.button,onClick:()=>n.postMessage({type:"createTask"}),children:"Create Task"}),e("button",{style:t.button,onClick:()=>n.postMessage({type:"setupCloud"}),children:"Cloud Setup"}),e("button",{style:t.button,onClick:()=>n.postMessage({type:"setApiBaseUrl"}),children:"Set API Base URL"}),e("button",{style:t.button,onClick:()=>n.postMessage({type:"setApiToken"}),children:"Set API Token"}),e("button",{style:t.button,onClick:()=>n.postMessage({type:"checkCloudConnection"}),disabled:!!s.isCloudChecking,children:s.isCloudChecking?"Checking Cloud\u2026":"Check Cloud Connection"}),e("button",{style:t.button,onClick:()=>n.postMessage({type:"syncLocalSessions"}),children:"Sync Local Sessions"})]})]}),e("details",{style:t.sectionCard,open:!0,children:[e("summary",{style:t.sectionSummary,children:"Section 2: Session Controls"}),e("div",{style:t.section,children:[e("button",{style:t.button,onClick:()=>F(o=>!o),disabled:s.isSessionActive,children:M?"Hide Create Session":"Create Session"}),M?e(v,{children:[e("textarea",{style:t.textarea,placeholder:"System prompt",value:y,onChange:o=>w(o.target.value),disabled:s.isSessionActive}),e("textarea",{style:t.textarea,placeholder:"User prompt",value:h,onChange:o=>N(o.target.value),disabled:s.isSessionActive}),e("button",{style:t.button,onClick:j,disabled:s.isSessionActive||!y.trim()||!h.trim(),children:"Start Session"})]}):null,e("button",{style:t.button,onClick:()=>n.postMessage({type:"stopSessionUpload"}),disabled:!s.isSessionActive,children:"Stop Session"}),e("button",{style:t.button,onClick:()=>n.postMessage({type:"submitFileChanges"}),disabled:!s.isSessionActive,children:"Submit File Changes"}),e("button",{style:t.button,onClick:()=>n.postMessage({type:"discardSession"}),disabled:!s.isSessionActive,children:"Discard Session"})]})]}),e("div",{style:t.sectionCard,children:e("div",{style:t.section,children:[e("h3",{style:t.sectionTitle,children:"search"}),e("input",{style:t.input,placeholder:"search path (optional)",value:k,onChange:o=>D(o.target.value),disabled:!s.isSessionActive}),e("input",{style:t.input,placeholder:"max results (default 20)",value:A,onChange:o=>L(o.target.value),disabled:!s.isSessionActive}),e("input",{style:t.input,placeholder:"grep query (e.g. useState|TODO|function name)",value:d,onChange:o=>m(o.target.value),disabled:!s.isSessionActive}),e("p",{style:t.helperText,children:"Leave path empty to search from workspace root."}),e("button",{style:t.button,onClick:U,disabled:!s.isSessionActive||!d.trim(),children:"Search Repo"}),e("input",{style:t.input,placeholder:"directory path to browse (e.g. src or src/lib)",value:S,onChange:o=>z(o.target.value),disabled:!s.isSessionActive}),e("button",{style:t.button,onClick:W,disabled:!s.isSessionActive||!S.trim(),children:"List + Open Directory Files"})]})}),e("div",{style:t.sectionCard,children:e("div",{style:t.section,children:[e("h3",{style:t.sectionTitle,children:"run_cmd"}),e("input",{style:t.input,placeholder:"--filter selector (optional)",value:r,onChange:o=>C(o.target.value),disabled:!s.isSessionActive}),e("p",{style:t.helperText,children:"Optional workspace selector used as `--filter <value>`."}),e("input",{style:t.input,placeholder:"packages for add/remove (space separated)",value:g,onChange:o=>f(o.target.value),disabled:!s.isSessionActive}),e("p",{style:t.helperText,children:"Used only for `add`, `add -D`, and `remove` actions."}),e("input",{style:t.input,placeholder:"timeout seconds",value:u,onChange:o=>l(o.target.value),disabled:!s.isSessionActive}),e("p",{style:t.helperText,children:"Command timeout in seconds (defaults to 120)."}),e("div",{style:t.buttonGrid,children:[e("button",{style:t.button,onClick:()=>p("install"),disabled:!s.isSessionActive,children:"pnpm i"}),e("button",{style:t.button,onClick:()=>p("add"),disabled:!s.isSessionActive,children:"pnpm add"}),e("button",{style:t.button,onClick:()=>p("addDev"),disabled:!s.isSessionActive,children:"pnpm add -D"}),e("button",{style:t.button,onClick:()=>p("remove"),disabled:!s.isSessionActive,children:"pnpm remove"}),e("button",{style:t.button,onClick:()=>p("lint"),disabled:!s.isSessionActive,children:"pnpm lint"}),e("button",{style:t.button,onClick:()=>p("test"),disabled:!s.isSessionActive,children:"pnpm test"}),e("button",{style:t.button,onClick:()=>p("build"),disabled:!s.isSessionActive,children:"pnpm build"})]})]})}),e("div",{style:t.sectionCard,children:e("div",{style:t.section,children:[e("h3",{style:t.sectionTitle,children:"export"}),e("input",{style:t.input,placeholder:"since (ISO datetime, optional)",value:T,onChange:o=>E(o.target.value)}),e("p",{style:t.helperText,children:"Example: 2026-02-21T20:00:00.000Z"}),e("input",{style:t.input,placeholder:"limit (optional)",value:R,onChange:o=>I(o.target.value)}),e("p",{style:t.helperText,children:"Maximum number of sessions to export."}),e("button",{style:t.button,onClick:O,children:"Export Task JSONL"}),e("button",{style:t.button,onClick:()=>n.postMessage({type:"importJsonlUpdates"}),children:"Validate + Import JSONL Updates"})]})}),e("div",{style:t.sectionCard,children:e("div",{style:t.section,children:[e("h3",{style:t.sectionTitle,children:"recent"}),(s.recentArtifacts??[]).length===0?e("p",{style:t.helperText,children:"No local artifacts yet."}):e("div",{style:t.recentList,children:(s.recentArtifacts??[]).map(o=>e("div",{style:t.recentItem,children:[e("button",{style:t.recentOpenButton,onClick:()=>n.postMessage({type:"openRecentArtifact",payload:{path:o.path}}),children:[e("span",{style:t.recentTitle,children:[o.type==="session"?"Session":"Export",o.status?` \u2022 ${o.status}`:""]}),e("span",{style:t.recentMeta,children:G(o.createdAt)})]}),e("button",{style:t.deleteButton,title:"Delete artifact",onClick:()=>n.postMessage({type:"deleteRecentArtifact",payload:{path:o.path}}),children:"\u{1F5D1}"})]},`${o.type}:${o.path}`))})]})})]})}var t={container:{fontFamily:"var(--vscode-font-family)",fontSize:"var(--vscode-font-size)",color:"var(--vscode-foreground)",padding:12,display:"flex",flexDirection:"column",gap:8},headerRow:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:8},cloudMeta:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:3},cloudTimestamp:{fontSize:"0.68rem",opacity:.7},title:{fontSize:"1rem",margin:0},sectionSummary:{cursor:"pointer",fontWeight:600,fontSize:"0.85rem",marginBottom:8},meta:{margin:0,opacity:.9},qualityRow:{display:"flex",alignItems:"center",gap:6},path:{margin:0,wordBreak:"break-all",opacity:.85,fontSize:"0.82rem"},sectionCard:{background:"var(--vscode-editorWidget-background)",border:"1px solid var(--vscode-editorWidget-border)",borderRadius:8,padding:8},section:{display:"flex",flexDirection:"column",gap:6},buttonGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6},recentList:{display:"flex",flexDirection:"column",gap:6},recentItem:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:6,padding:"6px 8px",borderRadius:6,border:"1px solid var(--vscode-input-border)",background:"var(--vscode-editor-background)"},recentOpenButton:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,width:"100%",padding:0,background:"transparent",border:"none",color:"var(--vscode-foreground)",cursor:"pointer",textAlign:"left"},deleteButton:{padding:"2px 6px",borderRadius:6,border:"1px solid var(--vscode-input-border)",background:"var(--vscode-editorWidget-background)",color:"var(--vscode-foreground)",cursor:"pointer",lineHeight:1},recentTitle:{fontSize:"0.78rem",fontWeight:500},recentMeta:{fontSize:"0.72rem",opacity:.7},sectionTitle:{fontSize:"0.85rem",fontWeight:600,margin:"2px 0",opacity:.9},input:{padding:"6px 8px",background:"var(--vscode-input-background)",border:"1px solid var(--vscode-input-border)",borderRadius:6,color:"var(--vscode-input-foreground)"},textarea:{padding:"6px 8px",minHeight:64,resize:"vertical",background:"var(--vscode-input-background)",border:"1px solid var(--vscode-input-border)",borderRadius:6,color:"var(--vscode-input-foreground)",fontFamily:"var(--vscode-editor-font-family, var(--vscode-font-family))",fontSize:"var(--vscode-font-size)"},helperText:{margin:"-2px 0 2px 0",fontSize:"0.75rem",opacity:.75,lineHeight:1.3},button:{padding:"6px 8px",background:"var(--vscode-button-background)",border:"1px solid var(--vscode-input-border)",borderRadius:6,color:"var(--vscode-button-foreground)",cursor:"pointer",textAlign:"left",fontWeight:500}};function J(s){return s==="ready"?{padding:"1px 6px",borderRadius:999,background:"var(--vscode-badge-background)",color:"var(--vscode-badge-foreground)",border:"1px solid var(--vscode-testing-iconPassed)",textTransform:"uppercase",fontSize:"0.72rem",letterSpacing:"0.04em"}:{padding:"1px 6px",borderRadius:999,background:"var(--vscode-badge-background)",color:"var(--vscode-badge-foreground)",border:"1px solid var(--vscode-input-border)",textTransform:"uppercase",fontSize:"0.72rem",letterSpacing:"0.04em"}}function V(s){return s==="connected"?{padding:"1px 6px",borderRadius:999,background:"var(--vscode-badge-background)",color:"var(--vscode-badge-foreground)",border:"1px solid var(--vscode-testing-iconPassed)",fontSize:"0.7rem"}:s==="unreachable"?{padding:"1px 6px",borderRadius:999,background:"var(--vscode-badge-background)",color:"var(--vscode-badge-foreground)",border:"1px solid var(--vscode-testing-iconFailed)",fontSize:"0.7rem"}:{padding:"1px 6px",borderRadius:999,background:"var(--vscode-badge-background)",color:"var(--vscode-badge-foreground)",border:"1px solid var(--vscode-input-border)",fontSize:"0.7rem"}}function H(s){switch(s){case"connected":return"Cloud: Connected";case"url-missing":return"Cloud: URL Missing";case"token-missing":return"Cloud: Token Missing";case"unreachable":return"Cloud: Unreachable"}}function Q(s){let i=new Date(s);return Number.isNaN(i.getTime())?"unknown":i.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit"})}function G(s){let i=new Date(s).getTime();if(Number.isNaN(i))return"unknown";let r=Math.max(0,Math.floor((Date.now()-i)/1e3));return r<60?`${r}s ago`:r<3600?`${Math.floor(r/60)}m ago`:r<86400?`${Math.floor(r/3600)}h ago`:`${Math.floor(r/86400)}d ago`}async function Z(){let s=document.getElementById("root");if(!s)return;let{createRoot:i}=await import("./client-XF7J6BAB.js");i(s).render(e($,{}))}Z();
